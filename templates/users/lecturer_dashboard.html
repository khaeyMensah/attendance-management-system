{% extends "users/dashboard_shell.html" %}
{% load static %}
{% block dashboard_title %}Lecturer Dashboard - ClassMark{% endblock dashboard_title %}
{% block dashboard_heading %}Lecturer Dashboard{% endblock dashboard_heading %}
{% block dashboard_subheading %}Welcome, {{ request.user.full_name|default:request.user.username }}. Manage your courses and active attendance sessions.{% endblock dashboard_subheading %}

{% block dashboard_stats %}
<div id="courses" class="mt-6 grid gap-4 sm:grid-cols-3">
  <div class="p-4 bg-white border rounded-lg">
    <div class="text-sm text-slate-500">Total Courses</div>
    <div class="text-2xl font-bold">{{ total_courses }}</div>
  </div>
  <div class="p-4 bg-white border rounded-lg">
    <div class="text-sm text-slate-500">Today's Sessions</div>
    <div class="text-2xl font-bold">{{ todays_sessions }}</div>
  </div>
  <div class="p-4 bg-white border rounded-lg">
    <div class="text-sm text-slate-500">Attendance Rate</div>
    {% if attendance_rate is not None %}
      <div class="text-2xl font-bold text-green-600">{{ attendance_rate }}%</div>
    {% else %}
      <div class="text-2xl font-bold text-slate-500">N/A</div>
    {% endif %}
  </div>
</div>
{% endblock dashboard_stats %}

{% block dashboard_actions %}
<div id="sessions" class="mt-8">
  <h2 class="text-lg font-semibold">Your Courses</h2>
  <div class="mt-3 grid gap-3">
    {% for course in courses %}
      <div class="flex flex-col gap-3 border rounded-lg p-4 bg-slate-50 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <p class="font-semibold">{{ course.code }}</p>
          <p class="text-sm text-slate-600">{{ course.title }}</p>
        </div>
        <div class="flex flex-wrap gap-2">
          <a
            href="{% url 'courses:lecturer_course_detail' course.id %}"
            class="inline-flex items-center justify-center px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-white"
          >
            View Sessions
          </a>
          <a
            href="{% url 'attendance:start_session' course.id %}"
            class="inline-flex items-center justify-center px-3 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700"
          >
            Start Session
          </a>
        </div>
      </div>
    {% empty %}
      <div class="border rounded-lg p-4 text-sm text-slate-600 bg-slate-50">
        No course assigned yet.
      </div>
    {% endfor %}
  </div>
</div>
{% endblock dashboard_actions %}

{% block dashboard_extra %}
<div id="attendance-reports" class="mt-8">
  <h2 class="text-lg font-semibold">Recent Session Activity</h2>
  <div class="mt-3 overflow-x-auto border rounded-lg max-w-full">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-50 text-slate-600">
        <tr>
          <th class="px-4 py-3 text-left">Course</th>
          <th class="px-4 py-3 text-left">Session</th>
          <th class="px-4 py-3 text-left">Present</th>
          <th class="px-4 py-3 text-left">Absent</th>
          <th class="px-4 py-3 text-left">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for session in recent_sessions %}
          <tr class="border-t">
            <td class="px-4 py-3">{{ session.course.code }}</td>
            <td class="px-4 py-3">{{ session.start_time|date:"M d, Y H:i" }}</td>
            <td class="px-4 py-3">{{ session.present_count }}</td>
            <td class="px-4 py-3">{{ session.absent_count }}</td>
            <td class="px-4 py-3">
              <a href="{% url 'attendance:session_records' session.id %}" class="text-indigo-700 hover:underline">Records</a>
              <span class="text-slate-300 px-1">|</span>
              <a href="{% url 'attendance:session_qr' session.id %}" class="text-indigo-700 hover:underline">QR</a>
            </td>
          </tr>
        {% empty %}
          <tr class="border-t">
            <td class="px-4 py-3 text-slate-500" colspan="5">No session activity yet.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock dashboard_extra %}
